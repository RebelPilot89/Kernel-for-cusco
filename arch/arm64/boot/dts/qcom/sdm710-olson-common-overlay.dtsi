/* Copyright (c) 2018, The Linux Foundation. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */

/*
 * Including features only applicable to Olson here
 */

#include <dt-bindings/clock/mdss-10nm-pll-clk.h>
#include "pm660a.dtsi"
#include "sdm670-sde-display.dtsi"
#include "sdm710-moto-common-overlay.dtsi"
#include "dsi-panel-mot-auo-620-876x2142-olson-cmd.dtsi"

/ {
        model = "Olson";
        compatible = "qcom,sdm670-olson", "qcom,sdm670-moto", "qcom,sdm670";
};

&soc {
	vci_disp_vreg: vci_disp_vreg {
		compatible = "regulator-fixed";
		regulator-name = "vci_disp";
		vin-supply = <&pm660l_l3>;
		gpio = <&tlmm 107 0>;
		enable-active-high;
		startup-delay-us = <300>;
		regulator-boot-on;
		pinctrl-names = "default";
		pinctrl-0 = <&disp_v1_en_default>;
	};

	vio_disp_vreg: vio_disp_vreg {
		compatible = "regulator-fixed";
		regulator-name = "vio_disp";
		vin-supply = <&pm660_l11>;
		gpio = <&tlmm 106 0>;
		startup-delay-us = <300>;
		enable-active-high;
		regulator-boot-on;
		pinctrl-names = "default";
		pinctrl-0 = <&disp_pwr_en_default>;
	};

	vci_disp_sub_vreg: vci_disp_sub_vreg {
		compatible = "regulator-fixed";
		regulator-name = "vci_disp_sub";
		vin-supply = <&pm660l_l3>;
		gpio = <&tlmm 105 0>;
		enable-active-high;
		startup-delay-us = <300>;
/*		regulator-boot-on;
*/
		pinctrl-names = "default";
		pinctrl-0 = <&disp_sub_avdd_en_default>;
	};

	vio_disp_sub_vreg: vio_disp_sub_vreg {
		compatible = "regulator-fixed";
		regulator-name = "vio_disp_sub";
		vin-supply = <&pm660_l11>;
		gpio = <&tlmm 100 0>;
		startup-delay-us = <300>;
		enable-active-high;
/*		regulator-boot-on;
*/
		pinctrl-names = "default";
		pinctrl-0 = <&disp_sub_dvdd_en_default>;
	};

	dsi_auo_620_876x2142_cmd_display: qcom,dsi-display@20 {
		compatible = "qcom,dsi-display";
		label = "dsi_auo_620_876x2142_cmd_display";
		qcom,display-type = "primary";

		qcom,dsi-ctrl = <&mdss_dsi0>;
		qcom,dsi-phy = <&mdss_dsi_phy0>;
		clocks = <&mdss_dsi0_pll BYTECLK_MUX_0_CLK>,
			<&mdss_dsi0_pll PCLK_MUX_0_CLK>;
		clock-names = "src_byte_clk", "src_pixel_clk";

		pinctrl-names = "panel_active", "panel_suspend";
		pinctrl-0 = <&sde_dsi_active &sde_te_active>;
		pinctrl-1 = <&sde_dsi_suspend &sde_te_suspend>;
		qcom,platform-te-gpio = <&tlmm 10 0>;
		qcom,dsi-panel = <&mot_auo_620_876x2142_cmd_v0>;
		l11_disp-supply = <&pm660_l11>;
		vci_disp-supply = <&vci_disp_vreg>;
		vio_disp-supply = <&vio_disp_vreg>;
		lab-supply = <&lab_regulator>;
		ibb-supply = <&ibb_regulator>;
		oledb-supply = <&pm660a_oledb>;
	};

	tzlog_dump {
		compatible = "mmi,tzlog-dump";
		memory-region = <&tzlog_dump_mem>;
	};

	mmi_annotate {
		compatible = "mmi,annotate";
		memory-region = <&mmi_annotate_mem>;
		mem-size = <0x20000>;
	};

	wdog_cputctx {
		compatible = "mmi,watchdog_cpu_ctx";
		memory-region = <&wdog_cpuctx_mem>;
	};

	fpc_fpc1020 {
		status = "ok";
		compatible = "fpc,fpc1020";
		reg = <0>;
		irq = <&tlmm 23 0>;
	};

};


/*
&pm660_l11 {
	regulator-boot-on;
	regulator-always-on;
};
*/


&pm660l_l6 {
	regulator-min-microvolt = <3300000>;
	regulator-max-microvolt = <3300000>;
	qcom,init-voltage = <3300000>;
	regulator-always-on;
};

&pm660l_l3 {
	regulator-min-microvolt = <3200000>;
	regulator-max-microvolt = <3200000>;
	qcom,init-voltage = <3200000>;
};

&mot_auo_620_876x2142_cmd_v0 {
        qcom,platform-reset-gpio = <&tlmm 6 0>;
	qcom,mdss-dsi-t-clk-post = <0x0c>;
	qcom,mdss-dsi-t-clk-pre = <0x2A>;
	qcom,mdss-dsi-display-timings {
		timing@0{
			qcom,mdss-dsi-panel-phy-timings = [00 1b 06 06 22 20 07
								07 04 03 04 00];
			qcom,display-topology = <1 0 1>;
			qcom,default-topology-index = <0>;
		};
	};
};

&tlmm {
	disp_v1_en {
		disp_v1_en_default: disp_v1_en_default {
			mux {
				pins = "gpio107";
				function = "gpio";
			};

			config {
				pins = "gpio107";
				drive-strength = <2>; /* 2 mA */
				bias-no-pull;
				output-enable;
			};
		};
	};

	disp_pwr_en {
		disp_pwr_en_default: disp_pwr_en_default {
			mux {
				pins = "gpio106";
				function = "gpio";
			};

			config {
				pins = "gpio106";
				drive-strength = <2>; /* 2 mA */
				bias-no-pull;
				output-enable;
			};
		};
	};

	disp_sub_v1_en {
		disp_sub_avdd_en_default: disp_sub_avdd_en_default {
			mux {
				pins = "gpio105";
				function = "gpio";
			};

			config {
				pins = "gpio105";
				drive-strength = <2>; /* 2 mA */
				bias-no-pull;
				output-enable;
			};
		};
	};

	disp_sub_v2_en {
		disp_sub_dvdd_en_default: disp_sub_dvdd_en_default {
			mux {
				pins = "gpio100";
				function = "gpio";
			};

			config {
				pins = "gpio100";
				drive-strength = <2>; /* 2 mA */
				bias-no-pull;
				output-enable;
			};
		};
	};

	ts_sub_rst_mux {
		ts_sub_rst_active: ts-sub-rst-active {
			mux {
				pins = "gpio99";
				function = "gpio";
			};
			config {
				pins = "gpio99";
				drive-strength = <2>;
				bias-disable;
			};
		};

		ts_sub_rst_suspend: ts-sub-rst-suspend {
			mux {
				pins = "gpio99";
				function = "gpio";
			};
			config {
				pins = "gpio99";
				drive-strength = <2>;
				bias-pull-down;
				output-low;
			};
		};
	};

	max17050_main_cc {
		max17050_main_cc_default: max17050_main_cc_default{
			mux {
				pins = "gpio123";
				function = "gpio";
			};

			config {
				pins = "gpio123";
				drive-strength = <2>; /* 2 mA */
				bias-no-pull;
			};
		};
	};

	max17050_flip_cc {
		max17050_flip_cc_default: max17050_flip_cc_default{
			mux {
				pins = "gpio49";
				function = "gpio";
			};

			config {
				pins = "gpio49";
				drive-strength = <2>; /* 2 mA */
				bias-no-pull;
			};
		};
	};
};

&reserved_memory{
	ramoops_mem {
		compatible = "ramoops";
		no-map;
		reg = <0x0 0xaf000000 0x0 0xc0000>;
		console-size = <0x40000>;
		pmsg-size = <0x40000>;
		record-size = <0x3f800>;
	};

	tzlog_dump_mem: tzlog_dump_mem_region {
		no-map;
		reg = <0x0 0xaefd0000 0x0 0x30000>;
	};

	mmi_annotate_mem: mmi_annotate_mem_region {
		no-map;
		reg = <0x0 0xaefcf800 0x0 0x800>;
	};

	wdog_cpuctx_mem: wdog_cpuctx_region {
		no-map;
		reg = <0x0 0xaefa1800 0x0 (0x5c00 * 8)>;
	};
};

&qupv3_se7_i2c {
	synaptics_dsx_i2c@20 {
		synaptics,splash-screen-mode;
	};
};

&qupv3_se4_i2c {
	status = "ok";
	max17050_main: max17050-battery-main@36 {
 		compatible = "maxim,max17050";
 		reg = <0x36>;
 		maxim,rsns-microohm = <5000>;

 		gpios = <&tlmm 123 0x21>; /* GPIOF_DIR_IN|GPIOF_EXPORT */
 		gpio-names = "cc-alert-main";
 		pinctrl-names = "default";
		pinctrl-0 = <&max17050_main_cc_default>;

 		maxim,main-psy;
 		maxim,enable_por_init;
 		maxim,batt_undervoltage_zero_soc;
 		maxim,batt-psy-name = "battery";

 		maxim,valrt-threshold = <0xffa0>; /* Vmin 3.2V */
		maxim,warm-temp-c = <45>;
		maxim,hot-temp-c = <60>;
		maxim,cool-temp-c = <0>;
		maxim,cold-temp-c = <(-20)>;
		maxim,temp-conv {
			start   = /bits/ 16 <(-20)>;    /* in degrees C */
			result  = /bits/ 16 <
				/* 1/10th C "real" temps corresponding start, start + 1, etc. fuel gauge temps in C */
				(-302) (-271) (-246) (-222) (-202) (-180) (-162) (-147) (-129) (-114)   /* -20 C ... -11 C */
				(-101) (-86)  (-72)  (-59)  (-48)  (-35)  (-23)  (-12)  (-2)   10       /* -10 C ... -1  C */
				22     32     42     51     62     72     82     91     99     110      /*  0  C ...  9  C */
				120    129    138    146    156    165    175    184    192    200      /*  10 C ...  19 C */
				210    220    230    238    247    256    266    275    285    294      /*  20 C ...  29 C */
				303    313    324    333    343    353    364    375    385    395      /*  30 C ...  39 C */
				407    419    430    441    453    466    479    492    505    520      /*  40 C ...  49 C */
				534    548    565    581    597    616    635    654    676    697      /*  50 C ...  59 C */
				721    747    775    800                                                /*  60 C ...  63 C */
			>;
		};
 	};
};

&qupv3_se10_i2c {
	status = "ok";
	max17050_flip: max17050-battery-flip@36 {
 		compatible = "maxim,max17050";
 		reg = <0x36>;
 		maxim,rsns-microohm = <5000>;

 		gpios = <&tlmm 49 0x21>; /* GPIOF_DIR_IN|GPIOF_EXPORT */
 		gpio-names = "cc-alert-flip";
 		pinctrl-names = "default";
		pinctrl-0 = <&max17050_flip_cc_default>;

 		maxim,enable_por_init;
 		maxim,batt_undervoltage_zero_soc;
 		maxim,batt-psy-name = "battery";

 		maxim,valrt-threshold = <0xffa0>; /* Vmin 3.2V */
		maxim,warm-temp-c = <45>;
		maxim,hot-temp-c = <60>;
		maxim,cool-temp-c = <0>;
		maxim,cold-temp-c = <(-20)>;
		maxim,temp-conv {
			start   = /bits/ 16 <(-20)>;    /* in degrees C */
			result  = /bits/ 16 <
				/* 1/10th C "real" temps corresponding start, start + 1, etc. fuel gauge temps in C */
				(-302) (-271) (-246) (-222) (-202) (-180) (-162) (-147) (-129) (-114)   /* -20 C ... -11 C */
				(-101) (-86)  (-72)  (-59)  (-48)  (-35)  (-23)  (-12)  (-2)   10       /* -10 C ... -1  C */
				22     32     42     51     62     72     82     91     99     110      /*  0  C ...  9  C */
				120    129    138    146    156    165    175    184    192    200      /*  10 C ...  19 C */
				210    220    230    238    247    256    266    275    285    294      /*  20 C ...  29 C */
				303    313    324    333    343    353    364    375    385    395      /*  30 C ...  39 C */
				407    419    430    441    453    466    479    492    505    520      /*  40 C ...  49 C */
				534    548    565    581    597    616    635    654    676    697      /*  50 C ...  59 C */
				721    747    775    800                                                /*  60 C ...  63 C */
			>;
		};
 	};
};

&qupv3_se9_2uart {
	status = "ok";
};

&qupv3_se12_2uart {
	status = "disabled";
};

&red_led {
	linux,name = "charging";
};
